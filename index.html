<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify API Example</title>
</head>
<body>
    <form id="song-search-form">
        <label for="song-name">Song name:</label>
        <input type="text" id="song-name" name="song-name" required>
        <button type="submit" >Search</button>
    </form>
    <div id="song-info"></div>

    <script>
        // Add an event listener for form submission
        const form = document.getElementById('song-search-form');
        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent the default form submission behavior
            const songName = document.getElementById('song-name').value;
            await searchSong(songName);
        });

        async function getAccessToken() {
            console.log('Getting access token...');
            // Replace this with a call to your backend endpoint or authentication proxy service
            const response = await fetch('https://d2k708hnw9.execute-api.ca-central-1.amazonaws.com/prod', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const data = await response.json();
            console.log('Access token:', data.access_token);
            return data.access_token;
        }


        async function searchSong(songName) {
            console.log('Searching for the song...');
            const accessToken = await getAccessToken();

            // Search for the song
            const searchResponse = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(songName)}&type=track&limit=1`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const searchData = await searchResponse.json();
            const track = searchData.tracks.items[0];
            console.log('Track found:', track);


            // Fetch the album to get the genres
            console.log('Fetching album data...');

            const albumResponse = await fetch(track.album.href, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const albumData = await albumResponse.json();
            console.log('Album data:', albumData);


            // Get the artist name and genres
            const artistName = track.artists[0].name;
            const genres = albumData.genres;

            // Update the HTML content
            console.log('Updating HTML content...');

            const songInfoElement = document.getElementById('song-info');
            songInfoElement.innerHTML = `
                <p>Artist: ${artistName}</p>
                <p>Genres: ${genres.join(', ') || 'N/A'}</p>
            `;
            console.log('HTML content updated');

        }
    </script>
</body>
</html>
