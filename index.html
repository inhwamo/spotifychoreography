<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify API Example</title>
    <style>
        .album-art {
            width: 300px;
            height: 300px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }
        .searching {
            display: none;
        }
    </style>
</head>
<body>
    <form id="song-search-form">
        <label for="song-name">Song name:</label>
        <input type="text" id="song-name" name="song-name" required>
        <button type="submit" >Search</button>
    </form>
    <div class="album-art" id="albumArtContainer">
        <p class="searching" id="searchingText">Searching...</p>
    </div>
    
    <div id="song-info"></div>

    <script>
        // Add an event listener for form submission
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('song-search-form');
            const albumArtContainer = document.getElementById('albumArtContainer');
            const searchingText = document.getElementById('searchingText');
            const songInfoElement = document.getElementById('song-info');

            form.addEventListener('submit', async (event) => {
                event.preventDefault();
                const songName = document.getElementById('song-name').value;

                // Show searching text and disable the button
                searchingText.style.display = 'block';
                form.querySelector('button').disabled = true;

            await searchSong(songName);

                // Hide searching text and enable the button after a delay
                searchingText.style.display = 'none';
                setTimeout(() => {
                    form.querySelector('button').disabled = false;
                }, 5000);
            });
        });
        async function getAccessToken() {
            console.log('Getting access token...');
            const response = await fetch('https://d2k708hnw9.execute-api.ca-central-1.amazonaws.com/prod/accesstoken', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const data = await response.json();
            if (data.access_token) {
                console.log('Access token:', data.access_token);
                return data.access_token;
            } else {
                throw new Error('Access token not received');
            }
        }


        async function searchSong(songName) {
            console.log('Searching for the song...');
            const accessToken = await getAccessToken();

            // Search for the song
            const searchResponse = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(songName)}&type=track&limit=1`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const searchData = await searchResponse.json();
            const track = searchData.tracks.items[0];
            console.log('Track found:', track);


            // Fetch the album to get the genres
            console.log('Fetching album data...');

            const albumResponse = await fetch(track.album.href, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const albumData = await albumResponse.json();
            console.log('Album data:', albumData);


            // Get the artist name and genres
            const artistName = track.artists[0].name;
            const genres = albumData.genres;
            const imageUrl = track.album.images[0].url;
            const albumName = track.album.name;
            const trackName = track.name;
            const releaseDate = track.album.release_date;
            // Update the HTML content
            console.log('Updating HTML content...');
            albumArtContainer.innerHTML = `<img src="${imageUrl}" alt="Album Art">`;

            // const songInfoElement = document.getElementById('song-info');
            songInfoElement.innerHTML = `
                <p>Artist: ${artistName}</p>
                <p>Album: ${albumName}</p>
                <p>Track: ${trackName}</p>
                <p>Release Date: ${releaseDate}</p>
                <p>Genres: ${genres.join(', ') || 'N/A'}</p>
            `;
            console.log('HTML content updated');

        }
    </script>
</body>
</html>
